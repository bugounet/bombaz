/*! bombaz 15-08-2015 */
function formatString(a,b){var c,d,e,f,g=a,h=0;for(c=FormattingStringRegex.exec(this.displayFormat);c;){if(d=c[0],e=c[1],void 0!==e){if(void 0===b[e])throw'Failed to format string "'+a+'" : '+e+" missing in formatting data (expression "+d+" not matched.";f=b[e]}else{if(void 0===b[h])throw'Failed to format string "'+a+'" : Not enough arguments in formatting data to match  expression "'+d+'".';f=b[h]}g=g.replace(d,f),h++,c=FormattingStringRegex.exec(this.displayFormat)}return h!==b.length&&console.warn('Formatting data unused while formatting "'+a+'"'),g}function EmptyCatalogItem(){"use strict";this.name="No result",this.displayFormat="%(name)s",this.toString=function(){formatString(this.displayFormat,{name:this.name})}}function CatalogItem(a){"use strict";this.name=a.name,this.price=a.price,this.specialOffer=0!==a.discount,this.finalPrice=a.price-a.discount,this.displayFormat="%(specialOfferPrefix)s%(name)s -- %(price)s GP",this.toString=function(){formatString(this.displayFormat,{name:this.name,price:this.finalPrice,specialOfferPrefix:this.specialOffer?"[PROMO]":""})}}function Promise(a){"use strict";var b=this;this._failsafe=void 0===a?!0:!!a,this._status="running",this._callbacks=null,this.done=function(a){return null===b._callbacks?b._callbacks=[a]:b._callbacks[b._callbacks.length]=a,"running"!==b._status?b._finish():b},this.succeed=function(){b._status="succeeded","busy"!==b._status&&b._finish()},this.fail=function(){b._status="failed",b._finish()},this.cancel=function(){b._status="cancelled",b._finish()},this._finish=function(){if(null===b._callbacks)return b;var a=0,c=b._status;for(b._status="busy",a=0;a<b._callbacks.length;a++)if(b._failsafe===!0)try{b._callbacks[a].call([c])}catch(d){console.error(d)}else b._callbacks[a].call([c]);return b._status=c,b._callbacks=[],b}}function Popup(a,b){"use strict";var c=this;this.id=a,this.type=b,this.message="",this.autoCloseTask=null,this.POPOUT_DURATION=500,this.color=POPUP_COLORS[b],void 0===this.color&&(this.color=POPUP_COLORS["default"]),this.pop=function(a){var b=document.querySelector("#popupPopingArea");if(null===b)throw"No popup container defined in current page.";c.message=a,b.innerHTML+='<div id="popup'+c.id+'" class="popup-popIn" style="background-color:'+c.color.background+";color:"+c.color.text+";z-index:"+c.id+'"> '+a+"</div>"},this.updateMessage=function(a){var b=document.querySelector("#popup"+c.id);if(null===b)throw"popup already closed";b.innerHTML=a,c.message=a},this.close=function(){null!==c.autoCloseTask&&(clearInterval(c.autoCloseTask),c.autoCloseTask=null);var a=new Promise,b=document.querySelector("#popup"+c.id);if(null===b)throw"popup already closed";b.className="popup-popOut";var d=setTimeout(function(){c.remove(),a.succeed()},c.POPOUT_DURATION);return c.autoCloseTask=d,a},this.remove=function(){null!==c.autoCloseTask&&clearInterval(c.autoCloseTask),c.autoCloseTask=null;var a=document.querySelector("#popupPopingArea");if(null===a)throw"popup container has been removed";var b=document.querySelector("#popup"+c.id);if(null===b)throw"popup already closed";a.removeChild(b)}}function PopupService(a){"use strict";var b=this;this.numberOfPopupsGenerated=0,this.autoCloseTask=null,this.currentPopup=null,this.defaultDisplayDuration=a,this._pop=function(a,c,d){if(null!==b.currentPopup)return console.warn("An other pop is still displayed. Will replace it as soon as possible."),b.autoCloseTask&&clearInterval(b.autoCloseTask),void b.currentPopup.close().done(function(){b.currentPopup=null,b._pop(a,c,d)});if(void 0===d&&(d=b.defaultDisplayDuration),d=Number(d),d!==d||0>=d)throw"Duration must be a positive integer.";var e=new Popup(b.numberOfPopupsGenerated,a);b.currentPopup=e;var f=setTimeout(function(){e.close().done(function(){b.currentPopup=null})},1e3*d);return console.warn("Created task ",f," (autoremoval of popup type ",a,")"),b.autoCloseTask=f,e.pop(c),b.numberOfPopupsGenerated++,e},this.info=function(a,b){return this._pop("info",a,b)},this.success=function(a,b){return this._pop("success",a,b)},this.warn=function(a,b){return this._pop("warn",a,b)},this.error=function(a,b){return this._pop("error",a,b)},this["default"]=function(a,b){return this._pop("default",a,b)}}var lobbyApp=angular.module("lobbyApp",["ngRoute","lobbyControllers"]);lobbyApp.config(function(a){a.startSymbol("%%"),a.endSymbol("%%")}),lobbyApp.config(["popupServiceProvider",function(a){a.popupDefaultDisplayDuration(2)}]);var lobbyControllers=angular.module("lobbyControllers",[]),j=0;lobbyControllers.controller("homeCtrl",["$scope","$http","popupService",function(a){"use strict";a.useMatchMaking=function(){console.log("match making!")},a.useCustomGame=function(){console.log("custom game!")},a.matchMakerAccept=function(){console.log("user accepts proposed game")},a.matchMakerDecline=function(){console.log("user declines game proposal")},a.matchMakerTimeout=function(){a.matchMakerDecline()},a.createGame=function(){console.log("Create game!")},a.joinGame=function(){console.log("Join game!")},a.customGameStart=function(){console.log("Start the game (We'll disappear from games list)")},a.customGameDelete=function(){console.log("Delete game and kick all gamers out of here.")},a.customGameKickGamer=function(a){console.log("Kicking ",a," out of the room.")},a.customGameSay=function(){var b=a.customGameMessageBox;console.log("Player says : ",b),a.customGameMessageBox=""},a.customGameLeave=function(){console.log("Player leaves the room")}}]),lobbyControllers.controller("navCtrl",["$scope","$location",function(a,b){a.navClass=function(a){var c=b.path().substring(1)||"home";return a===c?"active":""}}]),lobbyControllers.controller("preferencesController",["$scope","popupService",function(a){"use strict";a.me={name:"Bugounet",email:"sullivan.matas@example.com"},a.sound={volume:75,music:!1,effects:!0}}]),lobbyControllers.controller("scoresController",["$scope","$http",function(a){"use strict";a.list=";"}]);var FormattingStringRegex=/\%(\(\w+\))?[s]/gi;lobbyControllers.controller("storeController",["$scope","$http","popupService",function(a,b,c){"use strict";a.cart=[],a.storeGetMapsCatalog=function(){b.get({url:"lobby/api/store/catalogue/maps"}).success(function(b){a.fillCatalogue(b.maps)}).error(function(){c.error("Could not get maps catalogue."),a.catalogue=[new EmptyCatalogItem]})},a.storeGetSkinsCatalog=function(){b.get({url:"lobby/api/store/catalogue/skins"}).success(function(b){a.fillCatalogue(b.skins)}).error(function(){c.error("Could not get skins catalogue."),a.catalogue=[new EmptyCatalogItem]})},a.fillCatalogue=function(b){a.catalogue=[];var c,d,e=a.catalogue;for(c=0;c<b.length;c++)d=new CatalogItem(b[c]),e[e.length]=d},a.storeAddToCart=function(b){console.log("adding product ",b,"to cart");var d=a.cart;d[d.length]=b,c.info("Product added to cart")},a.storeRemoveFromCart=function(b){console.log("Removing ",b,"from cart");var d=a.cart.indexOf(b);return-1===d?void console.error("product not found in cart."):(a.cart.splice(d,1),void c.info("Product removed from cart"))},a.storeBuy=function(){console.log("Validating cart."),b.post({url:"lobby/api/v1_0/store/buy/",data:a.cart}).success(function(){a.cart=[],c.success("Order successfully completed.")}).error(function(){c.error("Could not validate your order. You have not been charged for that and the support team will contact you soon for further investigation.")})}}]),lobbyApp.directive("lobbyScoresTable",function(a,b){return function(c,d){function e(){b.get("/lobby/api/1.0/scores/"+h).success(function(a){var b='<li class="score">%d</li>\n',c="",e=0;for(e=0;e<a.list.length;e++)c+=b.replace("%d",a.list[e]);d.html(c)}).error(function(){d.text("Could'nt get scores")})}function f(){g=a(function(){e(),f()},1e3)}var g,h=0;d.bind("$destroy",function(){a.cancel(g)}),f()}});var POPUP_COLORS={info:{text:"#fff",background:"#0be"},warn:{text:"#221",background:"#f80"},error:{text:"#de0",background:"#b11"},success:{text:"#111",background:"#0d0"},"default":{text:"eee",background:"#342"}};lobbyApp.provider("popupService",function(){"use strict";var a=5;this.popupDefaultDisplayDuration=function(b){if(b=Number(b),b!==b)throw"Couldn't parse default display duration as a number of seconds.";if(0>=b)throw"Default display duration must be a strictly positive integer.";a=b},this.$get=[function(){return new PopupService(a)}]}),lobbyApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"/lobby/templates/home",controller:"homeCtrl"}).when("/scores",{templateUrl:"/lobby/templates/scores",controller:"scoresController"}).when("/store",{templateUrl:"/lobby/templates/store",controller:"storeController"}).when("/preferences",{templateUrl:"/lobby/templates/preferences",controller:"preferencesController"}).when("/game",{templateUrl:"/lobby/templates/game",controller:"gameController"}).otherwise({redirectTo:"/"})}]);