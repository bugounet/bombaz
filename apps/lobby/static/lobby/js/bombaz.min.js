/*! bombaz 16-05-2015 */
function formatString(a,b){var c,d,e,f,g=a,h=0;for(c=FormattingStringRegex.exec(this.displayFormat);c;){if(d=c[0],e=c[1],void 0!==e){if(void 0===b[e])throw'Failed to format string "'+a+'" : '+e+" missing in formatting data (expression "+d+" not matched.";f=b[e]}else{if(void 0===b[h])throw'Failed to format string "'+a+'" : Not enough arguments in formatting data to match  expression "'+d+'".';f=b[h]}g=g.replace(d,f),h++,c=FormattingStringRegex.exec(this.displayFormat)}return h!==b.length&&console.warn('Formatting data unused while formatting "'+a+'"'),g}function EmptyCatalogItem(){"use strict";this.name="No result",this.displayFormat="%(name)s",this.toString=function(){formatString(this.displayFormat,{name:this.name})}}function CatalogItem(a){"use strict";this.name=a.name,this.price=a.price,this.specialOffer=0!==a.discount,this.finalPrice=a.price-a.discount,this.displayFormat="%(specialOfferPrefix)s%(name)s -- %(price)s GP",this.toString=function(){formatString(this.displayFormat,{name:this.name,price:this.finalPrice,specialOfferPrefix:this.specialOffer?"[PROMO]":""})}}function Popup(a,b){"use strict";this.color=POPUP_COLORS[b],void 0===this.color&&(this.color=POPUP_COLORS["default"]),this.message="",this.pop=function(a){var b=document.querySelector("#popupPopingArea");if(null===b)throw"No popup container defined in current page.";this.message=a,b.innerHTML+='<div id="popup'+this.id+'" class="popup" style="background-color:'+this.color.background+";color:"+this.color.text+'">'+a+"</div>"},this.updateMessage=function(a){var b=document.querySelector("#popup"+this.id);if(null===b)throw"popup already closed";b.innerHTML=a,this.message=a},this.close=function(){var a=document.querySelector("#popupContainerArea");null===a&&console.error("popup container has been removed");var b=document.querySelector("#popup"+this.id);if(null===a)throw"popup already closed";a.removeChild(b)}}function PopupService(a){"use strict";this.numberOfPopupsGenerated=0,this.defaultDisplayDuration=a,this._pop=function(a,b,c){if(void 0===c&&(c=this.defaultDisplayDuration),c=Number(c),c!==c||0>=c)throw"Duration must be a positive integer.";var d=new Popup(this.numberOfPopupsGenerated,a);return setTimeout(d.close,c),d.pop(b),this.numberOfPopupsGenerated++,d},this.info=function(a,b){return this._pop("info",a,b)},this.success=function(a,b){return this._pop("success",a,b)},this.warn=function(a,b){return this._pop("warn",a,b)},this.error=function(a,b){return this._pop("error",a,b)},this["default"]=function(a,b){return this._pop("default",a,b)}}var lobbyApp=angular.module("lobbyApp",["ngRoute"]);lobbyApp.config(function(a){a.startSymbol("%%"),a.endSymbol("%%")}),lobbyApp.controller("navCtrl",["$scope","$location",function(a,b){a.navClass=function(a){var c=b.path().substring(1)||"home";return a===c?"active":""}}]),lobbyApp.controller("homeController",["$scope","$http","$popupService",function(a){"use strict";a.useMatchMaking=function(){console.log("match making!")},a.matchMakerAccept=function(){console.log("user accepts proposed game")},a.matchMakerDecline=function(){console.log("user declines game proposal")},a.matchMakerTimeout=function(){a.matchMakerDecline()},a.createGame=function(){console.log("Create game!")},a.joinGame=function(){console.log("Join game!")},a.customGameStart=function(){console.log("Start the game (We'll disappear from games list)")},a.customGameDelete=function(){console.log("Delete game and kick all gamers out of here.")},a.customGameKickGamer=function(a){console.log("Kicking ",a," out of the room.")},a.customGameSay=function(){var b=a.customGameMessageBox;console.log("Player says : ",b),a.customGameMessageBox=""},a.customGameLeave=function(){console.log("Player leaves the room")}}]),lobbyApp.controller("navCtrl",["$scope","$location",function(a,b){a.navClass=function(a){var c=b.path().substring(1)||"home";return a===c?"active":""}}]),lobbyApp.controller("preferencesController",["$scope","$popupService",function(a){"use strict";a.me={name:"Bugounet",email:"sullivan.matas@example.com"},a.sound={volume:75,music:!1,effects:!0}}]);var FormattingStringRegex=/\%(\(\w+\))?[s]/gi;lobbyApp.controller("storeController",["$scope","$http","$popupService",function(a,b,c){"use strict";a.cart=[],a.storeGetMapsCatalog=function(){b.get({url:"lobby/api/store/catalogue/maps"}).success(function(b){a.fillCatalogue(b.maps)}).error(function(){c.error("Could not get maps catalogue."),a.catalogue=[new EmptyCatalogItem]})},$scopre.storeGetSkinsCatalog=function(){b.get({url:"lobby/api/store/catalogue/skins"}).success(function(b){a.fillCatalogue(b.skins)}).error(function(){c.error("Could not get skins catalogue."),a.catalogue=[new EmptyCatalogItem]})},a.fillCatalogue=function(b){a.catalogue=[];var c,d,e=a.catalogue;for(c=0;c<b.length;c++)d=new CatalogItem(b[c]),e[e.length]=d},a.storeAddToCart=function(b){console.log("adding product ",b,"to cart");var d=a.cart;d[d.length]=b,c.info("Product added to cart")},a.storeRemoveFromCart=function(b){console.log("Removing ",b,"from cart");var d=a.cart.indexOf(b);return-1===d?void console.error("product not found in cart."):(a.cart.splice(d,1),void c.info("Product removed from cart"))},a.storeBuy=function(){console.log("Validating cart."),b.post({url:"lobby/api/v1_0/store/buy/",data:a.cart}).success(function(){a.cart=[],c.success("Order successfully completed.")}).error(function(){c.error("Could not validate your order. You have not been charged for that and the support team will contact you soon for further investigation.")})}}]),lobbyApp.directive("lobbyScoresTable",function(a,b){return function(c,d){function e(){b.get("/lobby/api/1.0/scores/"+h).success(function(a){var b='<li class="score">%d</li>\n',c="",e=0;for(e=0;e<a.list.length;e++)c+=b.replace("%d",a.list[e]);d.html(c)}).error(function(){d.text("Could'nt get scores")})}function f(){g=a(function(){e(),f()},1e3)}var g,h=0;d.bind("$destroy",function(){a.cancel(g)}),f()}});var POPUP_COLORS={info:{text:"#fff",backgound:"#0be"},warn:{text:"#221",backgound:"#f80"},error:{text:"#de0",backgound:"#b11"},success:{text:"#111",backgound:"#0d0"},"default":{text:"eee",background:"342"}};lobbyApp.provider(function(){"use strict";var a=5;this.popupDefaultDisplayDuration=function(b){if(b=Number(b),b!==b)throw"Couldn't parse default display duration as a number of seconds.";if(0>=b)throw"Default display duration must be a strictly positive integer.";a=b},this.$get=function(){return new PopupService(a)}}),lobbyApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"/lobby/templates/home",controller:"homeController"}).when("/scores",{templateUrl:"/lobby/templates/scores",controller:"scoresController"}).when("/store",{templateUrl:"/lobby/templates/store",controller:"storeController"}).when("/preferences",{templateUrl:"/lobby/templates/preferences",controller:"preferencesController"}).when("/game",{templateUrl:"/lobby/templates/game",controller:"gameController"}).otherwise({redirectTo:"/"})}]);